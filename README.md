# noraneko-package-repository

APT repository for Noraneko packages, managed with reprepro and hosted on Cloudflare Workers with GitHub release integration.

## Structure

```
repo/
├── conf/{distributions,updates,options} (reprepro configuration)
├── dists/stable/{Release,main/binary-amd64/Packages} (generated by reprepro)
├── pool/ (managed by reprepro)
├── wrangler.toml (assets.directory=".", worker proxies .deb files)  
├── worker.js (proxy /pool/*.deb from GitHub releases)
├── scripts/update-repo.sh (reprepro-based repository management)
└── .github/workflows/update-repo.yml (automated package updates)
```

## Usage

### Adding the repository to your system

```bash
echo "deb https://apt.domain.com/ stable main" | sudo tee /etc/apt/sources.list.d/noraneko.list
sudo apt update
```

### Deploying to Cloudflare Workers

```bash
wrangler deploy
```

### Adding packages manually

1. Place .deb files in the `incoming/` directory
2. Run the update script:
   ```bash
   ./scripts/update-repo.sh
   ```

### Automated package updates

The repository includes a GitHub workflow that automatically:
- Triggers on new releases
- Downloads .deb files from GitHub releases
- Updates the repository using reprepro
- Deploys to Cloudflare Workers

#### Required secrets:
- `GPG_PRIVATE_KEY`: GPG private key for signing packages
- `GPG_PASSPHRASE`: Passphrase for the GPG key
- `GPG_KEY_ID`: GPG key ID
- `CLOUDFLARE_API_TOKEN`: Cloudflare API token for deployment

## How it works

- **reprepro** manages the Debian repository structure, package indices, and metadata
- Static files (Release, Packages, pool/) are served directly from Cloudflare's edge
- .deb package files in `/pool/` can optionally be proxied through the Worker from GitHub releases
- The GitHub workflow automatically processes new releases and updates the repository
- All repository files are generated and maintained by reprepro, ensuring proper Debian standards compliance
